---
title: "Gatsby Blog ë‹¤í¬ ëª¨ë“œ ì ìš©ê¸°"
category: "React"
date: "2020-10-02"
desc: "Gatsby Blogì— ë‹¤í¬ ëª¨ë“œë¥¼ ì ìš©í•˜ë©° ëŠë‚€ ê²½í—˜ë‹´ì„ ê³µìœ í•©ë‹ˆë‹¤."
thumbnail: "./images/gatsby-dark-mode/thumbnail.png"
alt: ""
---

## â—ï¸ ì£¼ì˜ì‚¬í•­

í˜„ì¬ ë¸”ë¡œê·¸ëŠ” SSR ê´€ë ¨ ë¬¸ì œë¡œ styled-components ëŒ€ì‹  css varë¥¼ í†µí•´ì„œ í…Œë§ˆê°€ ì‘ì„±ëìŠµë‹ˆë‹¤ ğŸ˜¢... ì•„ë˜ ë‚´ìš©ì€ ê°œë°œ ì„œë²„ì—ì„  ì˜ ì‘ë™í•˜ì§€ë§Œ, ì‹¤ì œ ë°°í¬í™˜ê²½ì—ì„  ê·¸ë ‡ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì œê°€ ê²ªì—ˆë˜ ë¬¸ì œì™€, í•´ê²°ë²•ì„ ì˜ ì •ë¦¬í•´ì„œ í¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•  ì˜ˆì •ì…ë‹ˆë‹¤. SSRì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ì—ì„œ ë³¸ë¬¸ê³¼ ê°™ì€ ë‹¤í¬ëª¨ë“œ ì ìš©ë²•ì€ ì—¬ì „íˆ ìœ íš¨í•˜ë‹¤ê³  ìƒê°ë˜ë¯€ë¡œ(utterances í¬í•¨) ê¸€ ë‚´ìš©ì„ ì‚­ì œí•˜ì§„ ì•Šê² ìŠµë‹ˆë‹¤.

[ë§í¬](https://blog.rhostem.com/posts/2020-06-25-dark-mode-for-gatsby-website)ì—ì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ë„ì›€ì„ ë§ì´ ë°›ì•˜ìŠµë‹ˆë‹¤. ì°¸ê³  ë¶€íƒë“œë¦¬ë©°, ì¡°ë§Œê°„ ë” ì¢‹ì€ ê¸€ë¡œ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤!

## ë“¤ì–´ê°€ê¸° ì „ì—

ì´ë²ˆì— ë¸”ë¡œê·¸ë¥¼ ì œì‘í•˜ë©´ì„œ, ë‹¤í¬ ëª¨ë“œë¥¼ ì²˜ìŒ ë„ì…í•´ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆì„ ê±°ë¼ ìƒê°í–ˆëŠ”ë°, ì ìš© ê³¼ì • ì¤‘ì— êµ¬ê¸€ ê²€ìƒ‰ë§Œìœ¼ë¡œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ì´ìŠˆë“¤ì´ ì—¬ëŸ¬ ë²ˆ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ëŒ“ê¸€ì´ë‚˜ ì½”ë“œë¸”ëŸ­ í”ŒëŸ¬ê·¸ì¸ë„ í•¨ê»˜ ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜ë˜ì–´ì•¼ í–ˆëŠ”ë°, ì´ ë¶€ë¶„ì€ ê²€ìƒ‰í•´ë„ ìë£Œë¥¼ ì°¾ê¸°ê°€ í˜ë“¤ì—ˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë²ˆ ì‚½ì§ˆ ëì— ì˜ ì ìš©ì´ ëê³ , ì–´ë–»ê²Œ ì ìš©í–ˆëŠ”ì§€ ê²½í—˜ë‹´ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.

ì‚¬ìš©í–ˆë˜ í”ŒëŸ¬ê·¸ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ìŠ¤íƒ€ì¼ë§ì—ëŠ” styled-componentsë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

- ëŒ“ê¸€: utterances
- ì½”ë“œë¸”ëŸ­: gatsby-remark-vscode

## ë‹¤ì´ë‚´ë¯¹ í…Œë§ˆ(ëª¨ë“œ) ì ìš©í•˜ê¸°

ë‹¤í¬ëª¨ë“œë¥¼ ì ìš©í•˜ê³ ì í–ˆì„ ë•Œ, ê³ ë ¤í–ˆë˜ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ë””í´íŠ¸ ê°’ì„ ë¼ì´íŠ¸ í…Œë§ˆë¡œ ë‘ê³ , ë³„ë„ì˜ í† ê¸€ ë²„íŠ¼ì„ ë‘ì–´ ë¼ì´íŠ¸ í…Œë§ˆ <-> ë‹¤í¬ í…Œë§ˆ ê°„ ë³€ê²½ì´ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²Œ ì¼ë°˜ì ì¸ ë‹¤ì´ë‚´ë¯¹ í…Œë§ˆ ê¸°ëŠ¥ì¸ë°, ì´ë²ˆì— ì œì‘í•˜ëŠ” ë¸”ë¡œê·¸ì—ì„  ì‚¬ìš©ì„±ì„ ë” ê³ ë ¤í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤. ë””í´íŠ¸ ê°’ì„ ë‹¨ìˆœíˆ ë¼ì´íŠ¸ëª¨ë“œë¡œ ë‘ëŠ” ê²ƒë³´ë‹¤, ì‚¬ìš©ìì˜ í˜„ì¬ ì»´í“¨í„° ì‹œìŠ¤í…œì˜ í…Œë§ˆê°€ ì–´ë–¤ì§€, ì´ì „ì— í…Œë§ˆë¥¼ ë³€ê²½í–ˆë˜ ì ì´ ìˆëŠ”ì§€ë¥¼ ê³ ë ¤í•´ì„œ ë””í´íŠ¸ ê°’ì„ ê·¸ê²ƒì— ë§ê²Œ ë³€ê²½í•´ì£¼ëŠ” ê²Œ ë” ì‚¬ìš©ì„±ì´ ì¢‹ê² ì£ . ì œê°€ ìƒê°í–ˆë˜ ë””í´íŠ¸ í…Œë§ˆì˜ ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ì´ì „ì— ë¸”ë¡œê·¸ë¥¼ ë°©ë¬¸í•´ì„œ í…Œë§ˆë¥¼ ë³€ê²½í–ˆì„ ê²½ìš°, ê·¸ í…Œë§ˆ ì ìš©
2. ì‚¬ìš©ì ì‹œìŠ¤í…œ í…Œë§ˆ ì ìš©
3. ìœ„ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ë¼ì´íŠ¸í…Œë§ˆ ì ìš©

1ë²ˆì˜ ê²½ìš° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë‚˜ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë  ê±° ê°™ì€ë°, 2ë²ˆì˜ ê²½ìš°ê°€ ê¶ê¸ˆí–ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰í•´ë³´ë‹ˆ [prefers-color-scheme](https://developer.mozilla.org/ko/docs/Web/CSS/@media/prefers-color-scheme) ë¼ëŠ” CSS ë¯¸ë””ì–´ íŠ¹ì„±ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ ê°’ì„ [Window.matchMedia()](https://developer.mozilla.org/ko/docs/Web/API/Window/matchMedia)ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. matchMedia ë©”ì„œë“œëŠ” `MediaQueryList` ë¥¼ ë°˜í™˜í•˜ëŠ”ë°, `MediaQueryList` ì˜ `matches` í”„ë¡œí¼í‹°ë¡œ í˜„ì¬ ë„íë¨¼íŠ¸ì— ê°™ì€ ë¯¸ë””ì–´ì¿¼ë¦¬ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ì°¸ ê±°ì§“ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
const prefersColorScheme = window.matchMedia(('prefers-color-scheme: dark)').matches // TRUE of FALSE
```

ìœ„ ì½”ë“œë¡œ í˜„ì¬ ì‚¬ìš©ìì˜ ì‹œìŠ¤í…œ í…Œë§ˆê°€ ë¼ì´íŠ¸ í…Œë§ˆì¸ì§€ ë‹¤í¬ í…Œë§ˆì¸ì§€ ì°¸ ê±°ì§“ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•´ë³´ë©´ ë˜ê² ë„¤ìš”.

### useTheme ì»¤ìŠ¤í…€ í›… ë§Œë“¤ê¸°

React ë‹¤í¬ ëª¨ë“œì— ê´€í•´ ê²€ìƒ‰í•´ë³´ë©´ themeë¥¼ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `useTheme` í›…ì„ ë§ì´ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”, ëŒ€ë¶€ë¶„ ì½”ë“œì— ì‚¬ìš©ì ì„ í˜¸ í…Œë§ˆê¹Œì§€ ê³ ë ¤í•˜ê³  ìˆì§€ëŠ” ì•Šì•˜ìŠµë‹ˆë‹¤. ì•„ê¹Œ ì½”ë“œë¥¼ ë”í•´ `useTheme` í›…ì— ì‚´ì„ ë¶™ì—¬ë³´ê² ìŠµë‹ˆë‹¤.

```js
// src/hooks/useTheme.js
import { useState } from 'react';

const useTheme = () => {
  const prefersColorScheme = window.matchMedia((prefers-color-scheme: dark)).matches
    ? 'dark'
    : 'light';
  const localTheme = localStorage.getItem('theme');
  const initialTheme = localTheme || prefersColorScheme;
  const [theme, setTheme] = useState(initialTheme);

  return theme;
};

export default useTheme;
```

`prefersColorScheme` ì— ì‚¬ìš©ìì˜ í˜„ì¬ ì„ í˜¸ í…Œë§ˆê°€ ë‹¤í¬ëª¨ë“œë¼ë©´ `'dark'` ì•„ë‹ˆë©´ `'light'` ë¥¼ ë‹´ìŠµë‹ˆë‹¤. `2. ì‚¬ìš©ì ì‹œìŠ¤í…œ í…Œë§ˆ ì ìš©` ì— í•´ë‹¹í•˜ëŠ” ì¼€ì´ìŠ¤ì…ë‹ˆë‹¤.

ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ key `'theme'`ë¥¼ ê°€ì§„ ê°’ì„ í™•ì¸í•´ì„œ, ë³€ìˆ˜ `localTheme` ì— ë‹´ìŠµë‹ˆë‹¤. `1. ì´ì „ì— ë¸”ë¡œê·¸ë¥¼ ë°©ë¬¸í•´ì„œ í…Œë§ˆë¥¼ ë³€ê²½í–ˆì„ ê²½ìš°, ê·¸ í…Œë§ˆ ì ìš©` ì— í•´ë‹¹í•˜ëŠ” ì¼€ì´ìŠ¤ì…ë‹ˆë‹¤.

ìš°ì„ ìˆœìœ„ê°€ 1 -> 2 ê°€ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, í…Œë§ˆì˜ ì´ˆê¸°ê°’ì„ `1ë²ˆ ì¼€ì´ìŠ¤ || 2ë²ˆ ì¼€ì´ìŠ¤` ë¡œ ì ìš©í•´ì¤ë‹ˆë‹¤. ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê°’ì´ ì—†ì„ ê²½ìš° `null` ì„ ë°˜í™˜í•˜ë¯€ë¡œ, ìš°ì„ ìˆœìœ„ê°€ ì˜ ì ìš©ëìŠµë‹ˆë‹¤.

ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ë§Œ ìˆê³ , ì„¸íŒ…í•˜ëŠ” ë¶€ë¶„ì´ ìœ„ ì½”ë“œì—ëŠ” ì•„ì§ ì—†ìŠµë‹ˆë‹¤. í…Œë§ˆë¥¼ ë³€ê²½í•˜ê³ , ë³€ê²½ëœ í…Œë§ˆë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜ê°€ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” í…Œë§ˆ í† ê¸€ ë²„íŠ¼ì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ ë„˜ê²¨ì£¼ë©´ ë˜ê² ë„¤ìš”. ì½”ë“œë¥¼ ì¶”ê°€í•´ë³´ê² ìŠµë‹ˆë‹¤.

```js
import { useState } from 'react';

const useTheme = () => {
  const prefersColorScheme = window.matchMedia((prefers-color-scheme: dark)).matches
    ? 'dark'
    : 'light';
  const localTheme = localStorage.getItem('theme');
  const initialTheme = localTheme || prefersColorScheme;
  const [theme, setTheme] = useState(initialTheme);

  const setMode = (mode) => {
    localStorage.setItem('theme', mode);
    setTheme(mode);
  };

  const themeToggler = () => {
    theme === 'light' ? setMode('dark') : setMode('light');
  };

  return [theme, themeToggler];
};

export default useTheme;
```

ì´ì œ `useTheme` í›…ì€ `[theme, themeToggler]` ë¥¼ í•¨ê»˜ ë¦¬í„´í•©ë‹ˆë‹¤. `themeToggler` ëŠ” í…Œë§ˆ í† ê¸€ ë²„íŠ¼ì— ë„˜ê²¨ì¤„ í•¨ìˆ˜ì…ë‹ˆë‹¤. í…Œë§ˆê°€ ë¼ì´íŠ¸ í…Œë§ˆë¼ë©´ ë‹¤í¬ í…Œë§ˆë¡œ, ë‹¤í¬ í…Œë§ˆë¼ë©´ ë¼ì´íŠ¸ í…Œë§ˆë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ë³€ê²½ ì‹œì—ëŠ” `setMode(mode)` í•¨ìˆ˜ë¥¼ ê±°ì¹˜ê²Œ ë˜ëŠ”ë°, ì´ í•¨ìˆ˜ì—ì„œ `localStorage.setItem('theme', mode)` ì½”ë“œë¥¼ í†µí•´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í…Œë§ˆë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

Gatsbyì˜ Layout ì»´í¬ë„ŒíŠ¸ì—ì„œ ì•„ë˜ì™€ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì•„ë˜ ì˜ˆì‹œë¶€í„° importì‹œ ì ˆëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ë³„ë„ì˜ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì ˆëŒ€ê²½ë¡œê°€ ë™ì‘í•˜ì§€ ì•Šìœ¼ë‹ˆ ì°¸ê³ í•˜ì‹¤ ë¶„ë“¤ì€ ìœ ì˜ë°”ëë‹ˆë‹¤)

```js
// src/components/layout.js
import React from 'react';
import styled, { ThemeProvider } from 'styled-components';
import { lightTheme, darkTheme } from 'styles/theme';
import useTheme from 'hooks/useTheme';


const Layout = ({ children }) => {
  const [theme, themeToggler] = useTheme();
  const themeMode = theme === 'light' ? lightTheme : darkTheme;
  
  return (
   <ThemeProvider theme={themeMode}>
     <ThemeToggleButton onClick={themeToggler}></ThemeToggleButton>
     {children}
    </ThemeProvider>
  )
};

const ThemeToggleButton = styled.button`
 width: 200px;
 height: 200px;
 position: absolute;
 top: 50%;
 left: 50%:
 transform: transition(-50%, -50%);
 color: ${({ theme }) => theme.color.fontColor }; /* í…Œë§ˆì—ì„œ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ */
 background-color: ${({ theme }) => theme.color.backgroundColor };
`;

export default Layout;
```

`lightTheme` ì™€ `darkTheme` ê°ì²´ì˜ í‚¤ê°’ë“¤ì´ ì „ë¶€ ê°™ì•„ì•¼ ëœë‹¤ëŠ” ì ì„ ì£¼ì˜í•˜ì„¸ìš”. ê°ì²´ëª…ì€ ë³€ê²½ë¼ë„ ì „í˜€ ìƒê´€ì—†ì§€ë§Œ, í‚¤ê°’ì´ ë‹¤ë¥´ë‹¤ë©´ í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ìŠ¤íƒ€ì¼ë§ì´ ê¹¨ì§€ê²Œ ë©ë‹ˆë‹¤.

```js
// src/styles/theme.js
export const lightTheme = {
  backgroundColor: '#ffffff',
  fontColor: '#000000',
};

export const darkTheme = {
  backgroundColor: '#000000',
  fontColor: '#ffffff',
};

```

í˜„ì¬ ê°œë°œì¤‘ì¸ ë¸”ë¡œê·¸ì— ì ìš©í•´ë³¸ ì˜ˆì‹œì…ë‹ˆë‹¤. ìœ„ì—ì„œ ì‘ì„±í•œ ì½”ë“œì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í´ë¦­í•˜ê³  ìˆëŠ” ë²„íŠ¼(`ThemeToggleButton`)ì— `themeToggler` í•¨ìˆ˜ë¥¼ ë°”ì¸ë”©ì‹œì¼œì£¼ì—ˆìŠµë‹ˆë‹¤.

![í…Œë§ˆ ë³€ê²½](./images/gatsby-dark-mode/1.gif)

## utterances ëŒ“ê¸€ í”ŒëŸ¬ê·¸ì¸ì— ì ìš©í•˜ê¸°

ì—¬ê¸°ì„œ ë¬¸ì œê°€ í•˜ë‚˜ ë°œìƒí•˜ëŠ”ë°, í¬ìŠ¤íŠ¸ ì•ì—ì„œ ë§í–ˆë“¯ì´ **utterances ëŒ“ê¸€ í”ŒëŸ¬ê·¸ì¸ê³¼ ì½”ë“œë¸”ë¡ í”ŒëŸ¬ê·¸ì¸ì—ëŠ” ë‹¤ì´ë‚˜ë¯¹ í…Œë§ˆê°€ í•¨ê»˜ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** ì–´ë–»ê²Œ í•´ì•¼ ë‹¤ì´ë‚´ë¯¹ í…Œë§ˆë¥¼ í•¨ê»˜ ì ìš©í•  ìˆ˜ ìˆì„ì§€ utterances í”ŒëŸ¬ê·¸ì¸ ë¶€í„° ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. utterances í”ŒëŸ¬ê·¸ì¸ì„ gatsbyì— ì ìš©í•˜ëŠ” ë°©ë²•ì€ ì´ í¬ìŠ¤íŠ¸ì˜ ì£¼ì œì™€ ì–´ê¸‹ë‚˜ë¯€ë¡œ ë”°ë¡œ ì„¤ëª…í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤.

```js
// src/components/comment.js
import React, { useRef, useEffect } from 'react';
import { useSiteMetadata } from 'hooks/useSiteMetadata';

const src = 'https://utteranc.es';

const Comment = () => {
  const site = useSiteMetadata();
  const { repo } = site.siteMetadata.utterances;
  const containerRef = useRef(null);
  
  useEffect(() => {
   const comment = document.createElement('script');
    const attributes = {
      src: `${src}/client.js`,
      repo,
      'issue-term': 'title',
      label: 'comment',
      theme: 'github-light', // ì´ ë¶€ë¶„ì— ë‹¤ì´ë‚´ë¯¹ í…Œë§ˆê°€ ì ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
      crossOrigin: 'anonymous',
      async: 'true',
    };
    Object.entries(attributes).forEach(([key, value]) => {
      comment.setAttribute(key, value);
    });
    containerRef.current.appendChild(comment);
  }, [repo]);
  
  return <div ref={containerRef} />;
};

Comment.displayName = 'comment';

export default Comment;
```

ìœ„ì˜ ì½”ë“œë¥¼ ì ìš©í•˜ê³ , `Comment` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ ì›í•˜ëŠ” ê³³(ì•„ë§ˆ pagesë‚˜ templates ë””ë ‰í† ë¦¬ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ë  ê²ƒì…ë‹ˆë‹¤)ì— utterances ëŒ“ê¸€ í”ŒëŸ¬ê·¸ì¸ì„ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ëª©í•´ì•¼ í•  ê³³ì€ `attributes` ì˜ `theme` ì…ë‹ˆë‹¤. ì „ì²´ themeê°€ ë³€ê²½ë  ë•Œ, `theme` ê°’ë„ í•¨ê»˜ ë³€ê²½ë˜ë©´ ë©ë‹ˆë‹¤.

![utterances í…Œë§ˆ](./images/gatsby-dark-mode/2.png)

utterancesëŠ” ì—¬ëŸ¬ í…Œë§ˆë¥¼ ì œê³µí•˜ê³  ìˆëŠ”ë°ìš”. ë¼ì´íŠ¸ í…Œë§ˆëŠ” 'Github Light' í…Œë§ˆ, ë‹¤í¬ í…Œë§ˆëŠ” 'Github Dark' í…Œë§ˆë¥¼ ì ìš©í•˜ê²Œë” ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ë³€ê²½ë  `theme`ì—ëŠ” ì–´ë–»ê²Œ ì ‘ê·¼í•´ì•¼ í• ê¹Œìš”? ìŠ¤íƒ€ì¼ë“œ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œëŠ” `props.theme` ê°’ìœ¼ë¡œ í…Œë§ˆì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ë°, ì§€ê¸ˆì€ ìŠ¤íƒ€ì¼ë“œ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ `theme` ê°’ì— ì ‘ê·¼í•´ì•¼ë§Œ í•©ë‹ˆë‹¤. `useTheme` í›…ì„ ì—¬ê¸°ì„œ ë¶ˆëŸ¬ì˜¨ í›„ì— ì¬ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. `Layout` ì»´í¬ë„ŒíŠ¸ì˜ `themeToggler` ê°€ ë³€ê²½í•˜ëŠ” `theme` ìƒíƒœê°’ì€  `Layout` ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” `useTheme` í›…ì˜ `theme` ê°’ì´ê¸° ë•Œë¬¸ì—, `Comment` ì»´í¬ë„ŒíŠ¸ì—ì„œ `useTheme` í›…ì„ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•˜ë”ë¼ë„ `theme` ì˜ ìƒíƒœ ê°’ì´ ë³€ê²½ë˜ì§„ ì•Šì„ ê²ë‹ˆë‹¤.

> ê°™ì€ Hookì„ ì‚¬ìš©í•˜ëŠ” ë‘ ê°œì˜ ì»´í¬ë„ŒíŠ¸ëŠ” stateë¥¼ ê³µìœ í•˜ë‚˜ìš”? ì•„ë‹ˆìš”. ì‚¬ìš©ì ì •ì˜ Hookì€ ìƒíƒœ ê´€ë ¨ ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ì§€ë§Œ ì‚¬ìš©ì Hookì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ê·¸ ì•ˆì˜ stateì™€ effectëŠ” ì™„ì „íˆ ë…ë¦½ì ì…ë‹ˆë‹¤. (ì°¸ê³ : [React ê³µì‹ í™ˆí˜ì´ì§€](https://ko.reactjs.org/docs/hooks-custom.html))

ê·¸ë ‡ë‹¤ë©´ `Layout` ì»´í¬ë„ŒíŠ¸ì—ì„œ `theme` ê°’ì„ `Comment` ì»´í¬ë„ŒíŠ¸ì—ê²Œ ì „ë‹¬í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. `useContext` í›…ì„ í†µí•´ í•˜ìœ„ childrenì—ê²Œ `theme` ê°’ì„ ì „ë‹¬í•´ì£¼ë©´ ë˜ê² ë„¤ìš”. ê·¸ëŸ°ë° ì´ë¯¸ ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ì˜ `ThemeProvider` ë¥¼ í†µí•´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê³  ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ì „ë‹¬í•˜ê³  ìˆì–´ì„œ ì¤‘ë³µë˜ëŠ” ì‘ì—…ì„ í•˜ëŠ” ëŠë‚Œì´ ë“­ë‹ˆë‹¤. ì´ê±¸ í™œìš©í•  ë°©ë²•ì€ ì—†ì„ê¹Œìš”?

ë‹¤í–‰íˆ ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ `ThemeContext` ë¥¼ í•¨ê»˜ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë˜ ë§Œë“¤ì§€ ì•Šì•„ë„, `useContext` ë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ í˜„ì¬ í…Œë§ˆë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`theme` ëª…ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´, ë¨¼ì € `theme.js` íŒŒì¼ì— `theme` ê°’ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```js
// src/styles/theme.js
export const lightTheme = {
  theme: 'light',
  backgroundColor: '#ffffff',
  fontColor: '#000000',
};

export const darkTheme = {
  theme: 'dark',
  backgroundColor: '#000000',
  fontColor: '#ffffff',
};
```

'light' ì™€ 'dark' ë¬¸ìì—´ì´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ê³  ìˆìœ¼ë‹ˆ ë³„ë„ì˜ ìƒìˆ˜ íŒŒì¼ë¡œ ë¹¼ì„œ ê´€ë¦¬í•˜ëŠ” ê²Œ ì¢‹ì„ ê±° ê°™ìŠµë‹ˆë‹¤.

```js
// src/constants/constants.js
export const LIGHT = 'light';
export const DARK = 'dark';
```

ë§Œë“  ìƒìˆ˜ë¥¼ 'light' ì™€ 'dark' ë¬¸ìì—´ì´ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ import í•´ì£¼ê³  ëª¨ë‘ êµì²´í•©ë‹ˆë‹¤. ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ë¯€ë¡œ, ì˜ˆì‹œëŠ” ë³€ê²½ëœ `theme.js` íŒŒì¼ì˜ ì½”ë“œë§Œ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

```js
// src/styles/theme.js
import { LIGHT, DARK } from 'constants/constants';

export const lightTheme = {
  theme: LIGHT,
  backgroundColor: '#ffffff',
  fontColor: '#000000',
};

export const darkTheme = {
  theme: DARK,
  backgroundColor: '#000000',
  fontColor: '#ffffff',
};
```

ì´ì œ `Comment` ì»´í¬ë„ŒíŠ¸ì—ì„œ `theme` ê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…Œë§ˆì— ë”°ë¼ ê°’ì´ ë³€ê²½ë˜ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.

```js
// src/components/comment.js
import React, { useRef, useContext, useLayoutEffect } from 'react';
import { ThemeContext } from 'styled-components';
import { useSiteMetadata } from 'hooks/useSiteMetadata';
import { LIGHT } from 'constants/constants';

const src = 'https://utteranc.es';
const LIGHT_THEME = 'github-light';
const DARK_THEME = 'github-dark';

const Comment = () => {
  const { theme } = useContext(ThemeContext); // ê°ì²´ êµ¬ì¡° ë¶„í•´ í• ë‹¹ìœ¼ë¡œ theme ê°’ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ì´ì œ ë³€ê²½ë  themeì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
  const themeMode = theme === LIGHT ? LIGHT_THEME : DARK_THEME; // themeì— ë”°ë¼ utterancesì˜ í…Œë§ˆë¥¼ ì„¤ì •í•˜ëŠ” ë³€ìˆ˜ì…ë‹ˆë‹¤.
  
  const site = useSiteMetadata();
  const { repo } = site.siteMetadata.utterances;
  const containerRef = useRef(null);
  
 useEffect(() => {
   const comment = document.createElement('script');
   const attributes = {
      src: `${src}/client.js`,
      repo,
      'issue-term': 'title',
      label: 'comment',
      theme: themeMode, // themeMode ë³€ìˆ˜ë¡œ êµì²´í•©ë‹ˆë‹¤.
      crossOrigin: 'anonymous',
      async: 'true',
    };
    Object.entries(attributes).forEach(([key, value]) => {
      comment.setAttribute(key, value);
    });
    containerRef.current.appendChild(comment);
 }, [repo]);
  
  return <div ref={containerRef} />;
 };

Comment.displayName = 'comment';

export default Comment;
```

ì œëŒ€ë¡œ ì ìš©ëœ ê±° ê°™ìœ¼ë‹ˆ í•œ ë²ˆ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œì¼œë³¼ê¹Œìš”?

![utterances í…Œë§ˆ ìŠ¤ìœ„ì¹­ ì‹¤íŒ¨](./images/gatsby-dark-mode/3.gif)

ì•ˆíƒ€ê¹ê²Œë„ ì•„ì§ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. **í˜„ì¬ ì½”ë“œì—ì„  ì´ˆê¸°ì˜ `theme` ê°’ìœ¼ë¡œë§Œ í•œ ë²ˆ, ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ìƒì„±í•´ë²„ë¦¬ê¸° ë•Œë¬¸ì—** í…Œë§ˆê°€ ë™ì ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìœ„ ì˜ˆì‹œì—ì„  utterances í…Œë§ˆê°€ `useTheme` í›…ì—ì„œ ì´ˆê¹ƒê°’ìœ¼ë¡œ ì„¤ì •í•´ ë‘” `theme` ë¡œ ê³ ì •ëœ ëª¨ìŠµì…ë‹ˆë‹¤. (ê²Œë‹¤ê°€ ì˜ì¡´ì„± ë°°ì—´ì— `themeMode` ë¥¼ ì¶”ê°€í•˜ë©´ `Comment` ì»´í¬ë„ŒíŠ¸ê°€ í…Œë§ˆê°€ ë°”ë€” ë•Œë§ˆë‹¤ ê³„ì†í•´ì„œ ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤)

ì–´ë–»ê²Œ í•´ì•¼ utterances í…Œë§ˆë¥¼ ë™ì ìœ¼ë¡œ ë³€ê²½ë˜ê²Œ í•  ìˆ˜ ìˆì„ê¹Œìš”?

### window.postMessage() ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°

![iframe](./images/gatsby-dark-mode/4.png)

ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ utterancesëŠ” `iframe` ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. êµ¬ê¸€ë§ ê²°ê³¼ `window.postMessage()` ë©”ì„œë“œë¥¼ í†µí•´ `iframe` ì— ë©”ì„¸ì§€ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê±¸ ì•Œê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

> window.postMessage() ë©”ì†Œë“œëŠ” Window ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì—ì„œ ì•ˆì „í•˜ê²Œ cross-origin í†µì‹ ì„ í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆì‹œë¡œ, í˜ì´ì§€ì™€ ìƒì„±ëœ íŒì—… ê°„ì˜ í†µì‹ ì´ë‚˜, í˜ì´ì§€ì™€ í˜ì´ì§€ ì•ˆì˜ iframe ê°„ì˜ í†µì‹ ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì¶œì²˜: [MDN](https://developer.mozilla.org/ko/docs/Web/API/Window/postMessage))

ì—¬ê¸°ì„œ `Window` ì˜¤ë¸Œì íŠ¸ëŠ” ë¸Œë¼ìš°ì € ì „ì²´ì˜ ê°€ì¥ ìƒìœ„ ê°ì²´ì…ë‹ˆë‹¤. (ì°¸ê³ : [MDN](https://developer.mozilla.org/ko/docs/Web/API/Window)) ê·¸ë¦¬ê³  ì´ `Window` ì˜¤ë¸Œì íŠ¸ëŠ” ë˜ ë‹¤ë¥¸ ì›¹í˜ì´ì§€ì¸ `iframe` ì—ë„ ì¡´ì¬í•©ë‹ˆë‹¤. `HTMLIFrameElement.contentWindow` ì†ì„±ì„ í†µí•´ `iframe` ì—˜ë¦¬ë¨¼íŠ¸ì˜ `Window` ì˜¤ë¸Œì íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
  const message = {
    type: 'set-theme',
    theme: themeMode,
  };
  document.querySelector('iframe.utterances-frame').contentWindow.postMessage(message, src);
```

ìœ„ì™€ ê°™ì€ ì½”ë“œë¡œ utterancesì— 'í…Œë§ˆë¥¼ ë°”ê¿”ì¤˜!' ë¼ëŠ” ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…Œë§ˆê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤, ì´ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ë©´ ì œëŒ€ë¡œ ì‘ë™í•  ê±° ê°™ìŠµë‹ˆë‹¤.

### ì •ë¦¬ - utterances

`window.postMessage()` ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì™€ ê¸°ì¡´ì˜ ì½”ë“œë¥¼ í•©ì³ë³´ê² ìŠµë‹ˆë‹¤.

```js
// src/components/comment.js
import React, { useRef, useContext, useEffect } from 'react';
import { ThemeContext } from 'styled-components';
import { useSiteMetadata } from 'hooks/useSiteMetadata';
import { LIGHT } from 'constants/constants';

const src = 'https://utteranc.es';
const utterancesSelector = 'iframe.utterances-frame';
const LIGHT_THEME = 'github-light';
const DARK_THEME = 'github-dark';

const Comment = () => {
  const { theme } = useContext(ThemeContext);
  const themeMode = theme === LIGHT ? LIGHT_THEME : DARK_THEME;

  const site = useSiteMetadata();
  const { repo } = site.siteMetadata.utterances;
  const containerRef = useRef(null);

  useEffect(() => {
    const createUtterancesEl = () => {
      const comment = document.createElement('script');
      const attributes = {
        src: `${src}/client.js`,
        repo,
        'issue-term': 'title',
        label: 'comment',
        theme: themeMode,
        crossOrigin: 'anonymous',
        async: 'true',
      };
      Object.entries(attributes).forEach(([key, value]) => {
        comment.setAttribute(key, value);
      });
      containerRef.current.appendChild(comment);
    };

    const postThemeMessage = () => {
      const message = {
        type: 'set-theme',
        theme: themeMode,
      };
      utterancesEl.contentWindow.postMessage(message, src);
    };

    const utterancesEl = containerRef.current.querySelector(utterancesSelector);
    utterancesEl ? postThemeMessage() : createUtterancesEl();
  }, [repo, themeMode]);

  return <div ref={containerRef} />;
};

Comment.displayName = 'comment';

export default Comment;
```

í…Œë§ˆê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í•¨ìˆ˜ê°€ ì‹¤í–‰ë¼ì•¼ í•˜ë¯€ë¡œ, `useEffect` ì˜ì¡´ì„± ë°°ì—´ì— `themeMode` ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤. `iframe` ì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ë‹¤ë©´ `createUtterancesEl()` í•¨ìˆ˜ë¥¼ í†µí•´ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´ `postThemeMessage()` í•¨ìˆ˜ë¥¼ í†µí•´ ë©”ì„¸ì§€ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ í…Œë§ˆë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

![utterances ì ìš© ì™„ë£Œ](./images/gatsby-dark-mode/5.gif)

ë¯¸ì„¸í•œ ë”œë ˆì´ê°€ ìˆê¸°ëŠ” í•˜ì§€ë§Œ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
